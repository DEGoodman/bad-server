# bad-server
A poorly functioning server to test how your programming skills cope with difficult requirements. The ultimate goal is to produce a workable program that can obtain credentials, create a valid request, and retrieve a list of user GUIDs despite a misbehaving server. 

## Basic instructions
For this exercise, you are going to build a program to retrieve data from a flaky API. To be successful you will need to:
1.  Obtain and run a Docker image of this server. We will provide details when it's time.
2.  Navigate to `/auth` and retrieve the `clientID` and `secret` from the response headers
3.  Navigate to `/users` to retrieve your list of user, ensuring your request contains a valid Authorization header (See below)
4.  This server is intentionally fragile, your solution should be tolerant of misbehaviors.

## Details
### Navigation
The source code for this server is freely available and you are welcome to clone the repo, add debug logs, whatever you see fit. We will run this code against an internal docker image that may express somewhat different behavior so it is critical that your solution is flexible.

### Authorization
You will need to build an authorization token containing the clientId for the api and a md5 hash of the secret key concatenated with the target api. 
* The hash should be generated by the md5 hashing alorithm whose input should be `<secret>/<target>`
  * For example, if the /auth endpoint returned `secret: 123456` you would input `123456/users` into the algorithm.
* Your Authorization header should concatenate the provided clientId and your hash, e.g. `Authorization: <clientdId>:<hashedsecret>`
* The clientId is randomly generated during server initiation.
* The secret key will expire after 5 minutes, or 5 failed data retrieval attempts at the API, requiring you to obtain new credentials
* Successful calls to `/users` will not change credential expiration time or number of failed login attempts for better or worse.
* Calls `/auth` will invalidate prior credentials and return a new set that must be incorporated into your request to `/users`

### Users
Your goal is to obtain the list of user GUIDs from the `users` API. The data will be returned in the form of strings separated by newlines. The first line in the response will inform you how many GUIDS are expected to follow.

### Fragility
This server may misbehave in several ways including API timeouts, temporary authentication failures, and incomplete data in responses. You may treat a dropped connection or any response code other than a `200` as a failure. Your application should retry requests up to two more times before exiting with a failure response. As an added complexity, the server will not be aware if it hands off incomplete data. Be sure you are retrying appropriately and know what data you are expecting!

## Final thoughts
1. You may create your solution in any common programming language you feel comfortable in though Java, Javascript, or Python are preferred. Your solution should contain all relevant instructions for an average developer in your language of choice to be able to run the code, any tests, etc. on their local laptop.
2. Feel free to document your code however you feel appropriate and believe would be important for reviewers to know. We strongly believe there is no one right way to write code and we are more interested in _why_ you made the choices you did rather than _what_ the choices are. We will likely discuss this in more detail during the on-site and you will have plenty of time to explain then.
3. All of your code for this exercise should be uploaded to Github ar some other publicly-available repository so that we can download, review, and build your code independently.
4. We would love to run your solution as a Docker image or view some sort of GUI that presents the data to a theoretical operator, but that is absolutely not required. A well-implemented CLI script is just as valid. 
5. We created this exercise that it should take an average developer about *three hours* to implement a workable solution. This is intended as a starting point for conversations and we don't require something production-grade or that can scale to millions of users. If you aren't 100% satisfied with your results, that's ok! We encourage you to submit what you have completed and we will take into consideration the overall state of your implementation. You'll have time to discuss future improvements or things you would do differently next time in person. This is equally if not more valuable to us than a "perfect" solution. If you find that you are spending significantly longer than three hours, please get in touch with your recruiter and we will discuss next step.



## Quickstart
This app can be run as a standalone go package or via docker to extend potential testing in clustered environments. To run:
``` 
docker build -t bad-server .
docker run -p 8080:8080 bad-server 
```
By default this app will log to stdout. If you run the daemon in detatched mode, you can tail the app logs via `docker logs --follow <image id>`. If you want to log to a persistent volume, the application can target the location by setting the environment variable `LOG_FILE_LOCATION` to the desired output location.


## Status
1. When navigating to the app root, the user will see very basic instructions. These will explain the steps to retrieve the users list, but not in enough detail to do so without explicit instructions provided by this README (intentionally).
2. Calling /auth returns the client_id and a secret key. Users will need to form a valid request by hashing the key correctly. 
3. /users returns the number of users and a list of GUIDs delimited by newlines


## Next
Next steps for the app are:
1. implement mock unstable behaviors (timeouts, error responses, auth failure, incomplete data, etc.)


## Credits
Thanks to:
- https://homework.adhoc.team/noclist/ for the idea
- https://www.callicoder.com/docker-golang-image-container-example/ for the golang server/ docker container inspiration
- https://next.json-generator.com/4yS-UfgXu for providing the sample data

[1]: https://en.wikipedia.org/wiki/Representational_state_transfer#Uniform_interface
